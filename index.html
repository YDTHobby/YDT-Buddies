<!DOCTYPE HTML>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>YDT Barnyard Buddies - Arcade Machine</title>
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="css/arcade-style.css">
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <style>
    html, body {
      width: 100%; height: 100%; margin: 0; padding: 0;
      overflow: hidden;
      font-family: 'Courier New', monospace;
      background: #1a1a1a;
      touch-action: none;
      -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;
    }
    #arcadeWrapper {
      width: 100vw; height: 100vh;
      display: flex; justify-content: center; align-items: center;
      transform-origin: center center;
    }
    #arcadeMachine {
      width: 500px !important; height: 900px !important; position: relative;
    }
    #leftBtn::after { content: 'LEFT'; }
    #rightBtn::after { content: 'RIGHT'; }
    * { -webkit-tap-highlight-color: transparent; }
    button {
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
      outline: none; border: none;
    }
  </style>
</head>
<body>
  <div id="arcadeWrapper">
    <div id="arcadeMachine">
      <div class="side-speaker left"></div>
      <div class="side-speaker right"></div>
      <div class="coin-slot"></div>
      <div class="instructions">Use LEFT & RIGHT to move. Press JUMP to fly!</div>
      <div id="marquee" class="arcade-text arcade-glow">
        <h1>YDT BARNYARD BUDDIES</h1>
      </div>
      <div id="screenBezel" class="crt-flicker">
        <div id="screenContainer">
          <div id="hudDisplay" class="high-score-display">COINS: 0</div>
          <canvas id="gameFrame" width="320" height="480"></canvas>
          <div class="scanlines"></div>
        </div>
      </div>
      <div id="controlPanel">
        <div class="button-row">
          <button class="arcadeButton small" id="leftBtn"></button>
          <button class="arcadeButton small" id="rightBtn"></button>
        </div>
        <div class="button-row">
          <button class="arcadeButton red" id="jumpBtn"></button>
        </div>
        <div class="button-row">
          <button class="arcadeButton small green" id="startBtn"></button>
          <button class="arcadeButton small blue" id="pauseBtn"></button>
        </div>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('touchstart', function(e) {
      if (e.target.closest('#controlPanel') || e.target.closest('#gameFrame')) {
        e.preventDefault();
      }
    }, { passive: false });

    function simulateKey(keyCode, key, isDown) {
      const event = new KeyboardEvent(isDown ? 'keydown' : 'keyup', {
        bubbles: true,
        cancelable: true,
        keyCode: keyCode,
        which: keyCode,
        key: key,
        code: key,
        charCode: isDown ? 0 : keyCode
      });
      const canvas = document.getElementById('gameFrame');
      if (canvas) canvas.dispatchEvent(event);
      document.dispatchEvent(event);
      window.dispatchEvent(event);
    }

    function setupButton(buttonId, keyCode, keyName) {
      const btn = document.getElementById(buttonId);
      if (!btn) return;

      let isPressed = false;

      const press = (e) => {
        e.preventDefault();
        e.stopPropagation();
        if (!isPressed) {
          isPressed = true;
          simulateKey(keyCode, keyName, true);
          btn.classList.add('pressed');
        }
      };

      const release = (e) => {
        e.preventDefault();
        e.stopPropagation();
        if (isPressed) {
          isPressed = false;
          simulateKey(keyCode, keyName, false);
          btn.classList.remove('pressed');
        }
      };

      btn.addEventListener('touchstart', press, { passive: false });
      btn.addEventListener('touchend', release, { passive: false });
      btn.addEventListener('touchcancel', release, { passive: false });
      btn.addEventListener('mousedown', press);
      btn.addEventListener('mouseup', release);
      btn.addEventListener('mouseleave', release);
    }

    function setupControls() {
      setupButton('leftBtn', 37, 'ArrowLeft');
      setupButton('rightBtn', 39, 'ArrowRight');
      setupButton('jumpBtn', 38, 'ArrowUp');
      setupButton('startBtn', 13, 'Enter');
      setupButton('pauseBtn', 27, 'Escape');
    }

    window.addEventListener('load', () => {
      setTimeout(setupControls, 100);
    });

    document.addEventListener('DOMContentLoaded', setupControls);
  </script>

  <script>
    function scaleArcade() {
      const wrap = document.getElementById('arcadeWrapper');
      const machine = document.getElementById('arcadeMachine');
      const W = window.innerWidth;
      const H = window.innerHeight;
      const MACHINE_W = 500;
      const MACHINE_H = 900;
      const MARQUEE_TOP = 80;
      const totalHeight = MACHINE_H + MARQUEE_TOP;
      const scaleX = W / MACHINE_W;
      const scaleY = H / totalHeight;
      const scale = Math.min(scaleX, scaleY) * 0.95;
      wrap.style.transform = `scale(${scale})`;
    }
    window.addEventListener('resize', scaleArcade);
    window.addEventListener('load', scaleArcade);
    window.addEventListener('orientationchange', scaleArcade);
    scaleArcade();
    document.addEventListener('gesturestart', function(e) { e.preventDefault(); });
  </script>

  <style>
    .arcadeButton.pressed {
      transform: translateY(3px);
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5), inset 0 -2px 5px rgba(0, 0, 0, 0.3);
    }
  </style>
</body>
</html>
