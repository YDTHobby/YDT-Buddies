<!DOCTYPE HTML>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>YDT Barnyard Buddies - Arcade Machine</title>
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="css/arcade-style.css">
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <style>
    html, body {
      width: 100%;
      height: 100%;
      margin: 0;
      padding: 0;
      overflow: hidden;
      font-family: 'Courier New', monospace;
      background: #1a1a1a;
    }

    #arcadeWrapper {
      width: 100vw;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      transform-origin: top center;
    }

    #arcadeMachine {
      width: 95vw;
      max-width: 500px;
      aspect-ratio: 10 / 18;
    }

    @media (max-width: 600px), (max-height: 700px) {
      #arcadeMachine {
        width: 95vw;
        max-width: 400px;
        height: auto;
      }
    }
  </style>

  <!-- Game Scripts -->
  <script src="js/arcade-detection.js"></script>
  <script src="lib/quintus.js"></script>
  <script src="lib/quintus_input.js"></script>
  <script src="lib/quintus_scenes.js"></script>
  <script src="lib/quintus_sprites.js"></script>
  <script src="lib/quintus_touch.js"></script>
  <script src="lib/quintus_ui.js"></script>
  <script src="lib/quintus_tmx.js"></script>
  <script src="lib/quintus_2d.js"></script>
  <script src="lib/quintus_anim.js"></script>
  <script src="lib/quintus_audio.js"></script>
  <script src="js/game.js"></script>
  <script src="js/nugget.js"></script>
  <script src="js/defaultenemy.js"></script>
  <script src="js/tangledyarn.js"></script>
  <script src="js/cat.js"></script>
  <script src="js/princessmabel.js"></script>
  <script src="js/yarnball.js"></script>
  <script src="js/endgame.js"></script>
  <script src="js/maintitle.js"></script>
  <script src="js/level1.js"></script>
  <script src="js/hub.js"></script>
</head>

<body>
  <div id="arcadeWrapper">
    <div id="arcadeMachine">
      <div class="side-speaker left"></div>
      <div class="side-speaker right"></div>
      <div class="coin-slot"></div>
      <div class="instructions">Touch joystick to move. Press Jump to fly!</div>

      <div id="marquee" class="arcade-text arcade-glow">
        <h1>YDT BARNYARD BUDDIES</h1>
      </div>

      <div id="screenBezel" class="crt-flicker">
        <div id="screenContainer">
          <div id="hudDisplay" class="high-score-display">COINS: 0</div>
          <canvas id="gameFrame" width="320" height="480"></canvas>
          <div class="scanlines"></div>
        </div>
      </div>

      <div id="controlPanel">
        <div class="joystick-container">
          <div class="joystick" id="joystick"></div>
        </div>
        <div class="button-row">
          <button class="arcadeButton red" id="jumpBtn"></button>
        </div>
        <div class="button-row">
          <button class="arcadeButton small green" id="startBtn"></button>
          <button class="arcadeButton small blue" id="pauseBtn"></button>
        </div>
      </div>
    </div>
  </div>

  <!-- Control & Input Setup -->
  <script>
    function simulateKey(key, isDown) {
      const event = new KeyboardEvent(isDown ? 'keydown' : 'keyup', { key, bubbles: true });
      document.dispatchEvent(event);
    }

    function setupJoystick() {
      const joystickEl = document.getElementById('joystick');
      const container = joystickEl.parentElement;
      let active = false, lastLeft = false, lastRight = false;

      const updateJoystick = (e) => {
        if (!active) return;
        const rect = container.getBoundingClientRect();
        const x = (e.touches ? e.touches[0].clientX : e.clientX) - (rect.left + rect.width / 2);
        const moveX = Math.max(-rect.width/2 + 25, Math.min(rect.width/2 - 25, x));
        joystickEl.style.transform = `translate(${moveX}px, 0)`;

        const left = moveX < -10, right = moveX > 10;
        if (left !== lastLeft) simulateKey('ArrowLeft', left), lastLeft = left;
        if (right !== lastRight) simulateKey('ArrowRight', right), lastRight = right;
      };

      const start = (e) => { e.preventDefault(); active = true; updateJoystick(e); };
      const end = () => {
        active = false;
        joystickEl.style.transform = 'translate(0, 0)';
        simulateKey('ArrowLeft', false);
        simulateKey('ArrowRight', false);
        lastLeft = lastRight = false;
      };

      container.addEventListener('mousedown', start);
      container.addEventListener('touchstart', start);
      window.addEventListener('mousemove', updateJoystick);
      window.addEventListener('touchmove', updateJoystick);
      window.addEventListener('mouseup', end);
      window.addEventListener('touchend', end);
    }

    function setupButton(id, key) {
      const btn = document.getElementById(id);
      if (!btn) return;
      const press = e => { e.preventDefault(); simulateKey(key, true); };
      const release = e => { e.preventDefault(); simulateKey(key, false); };

      btn.addEventListener('mousedown', press);
      btn.addEventListener('touchstart', press);
      btn.addEventListener('mouseup', release);
      btn.addEventListener('touchend', release);
      btn.addEventListener('mouseleave', release);
    }

    function setupControls() {
      setupJoystick();
      setupButton('jumpBtn', 'ArrowUp');
      setupButton('startBtn', 'Enter');
      setupButton('pauseBtn', 'Escape');
    }

    window.addEventListener('load', setupControls);
  </script>

  <!-- Perfect-Fit Scaling -->
  <script>
    function scaleArcade() {
      const wrap = document.getElementById('arcadeWrapper');
      const W = window.innerWidth;
      const H = window.innerHeight;
      const origW = 500;
      const origH = 900;
      const scale = Math.min(W / origW, H / origH);
      wrap.style.transform = `scale(${scale})`;
    }
    window.addEventListener('load', scaleArcade);
    window.addEventListener('resize', scaleArcade);
  </script>
</body>
</html>
