<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>YDT Barnyard Buddies - Arcade Cabinet</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background-color: #1a1a1a;
      font-family: 'Courier New', monospace;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
    #screenContainer {
      width: 320px;
      height: 480px;
      position: relative;
      background: #000;
      box-shadow: inset 0 0 30px rgba(255,255,255,0.1);
      border-radius: 10px;
    }
    canvas {
      display: block;
      width: 100%;
      height: 100%;
    }
    #controls {
      margin-top: 20px;
      display: flex;
      justify-content: center;
      gap: 15px;
    }
    .arcadeButton {
      width: 60px;
      height: 60px;
      background: radial-gradient(circle at 30% 30%, #ff3333, #cc0000);
      border-radius: 50%;
      border: none;
      cursor: pointer;
      box-shadow: 0 5px 10px rgba(0,0,0,0.5);
      color: white;
      font-weight: bold;
    }
    .arcadeButton:active {
      transform: translateY(2px);
    }
  </style>
</head>
<body>
  <div>
    <div id="screenContainer"></div>
    <div id="controls">
      <button class="arcadeButton" id="leftBtn">◀</button>
      <button class="arcadeButton" id="jumpBtn">▲</button>
      <button class="arcadeButton" id="rightBtn">▶</button>
      <button class="arcadeButton" id="startBtn">⏎</button>
      <button class="arcadeButton" id="pauseBtn">⏸</button>
    </div>
  </div>

  <!-- Quintus Engine -->
  <script src="lib/quintus.js"></script>
  <script src="lib/quintus_input.js"></script>
  <script src="lib/quintus_sprites.js"></script>
  <script src="lib/quintus_scenes.js"></script>
  <script src="lib/quintus_2d.js"></script>
  <script src="lib/quintus_anim.js"></script>
  <script src="lib/quintus_touch.js"></script>
  <script src="lib/quintus_ui.js"></script>
  <script src="lib/quintus_tmx.js"></script>
  <script src="lib/quintus_audio.js"></script>

  <!-- Game Files -->
  <script src="js/nugget.js"></script>
  <script src="js/princess.js"></script>
  <script src="js/enemy.js"></script>
  <script src="js/tangledyarn.js"></script>
  <script src="js/cat.js"></script>
  <script src="js/yarnball.js"></script>
  <script src="js/endgame.js"></script>
  <script src="js/mainTitle.js"></script>
  <script src="js/hub.js"></script>
  <script src="js/level1.js"></script>
  <script src="js/game.js"></script>

  <script>
    let Q;
    window.addEventListener('load', function () {
      Q = Quintus({ audioSupported: ['mp3','ogg'] })
        .include("Sprites, Scenes, Input, 2D, Anim, Touch, UI, TMX, Audio")
        .setup("screenContainer", { width: 320, height: 480 })
        .controls().touch().enableSound();

      if (typeof loadNugget === 'function') loadNugget(Q);
      if (typeof loadPrincessMabel === 'function') loadPrincessMabel(Q);
      if (typeof loadDefaultEnemy === 'function') loadDefaultEnemy(Q);
      if (typeof loadTangledyarn === 'function') loadTangledyarn(Q);
      if (typeof loadCat === 'function') loadCat(Q);
      if (typeof loadYarnball === 'function') loadYarnball(Q);
      if (typeof loadEndGame === 'function') loadEndGame(Q);
      if (typeof loadMainTitle === 'function') loadMainTitle(Q);
      if (typeof loadHUB === 'function') loadHUB(Q);
      if (typeof loadLevel1 === 'function') loadLevel1(Q);

      Q.loadTMX("level.tmx, mainTitle.png, nugget_small.png, nugget_small.json, tangledyarn.png, tangledyarn.json, cat.png, cat.json, princess.png, yarnball.png, yarnball.json, music_main.mp3, music_main.ogg, music_die.mp3, music_die.ogg, music_level_complete.mp3, music_level_complete.ogg, yarnball.mp3, yarnball.ogg", function() {
        Q.compileSheets("nugget_small.png", "nugget_small.json");
        Q.compileSheets("tangledyarn.png", "tangledyarn.json");
        Q.compileSheets("cat.png", "cat.json");
        Q.compileSheets("yarnball.png", "yarnball.json");
        Q.stageScene("mainTitle");
      });
    });

    function simulateKey(key, isDown) {
      const event = new KeyboardEvent(isDown ? 'keydown' : 'keyup', {
        key,
        bubbles: true,
      });
      window.dispatchEvent(event);
    }

    function setupArcadeButtons() {
      const bindButton = (id, key) => {
        const btn = document.getElementById(id);
        btn.addEventListener('mousedown', () => simulateKey(key, true));
        btn.addEventListener('mouseup', () => simulateKey(key, false));
        btn.addEventListener('touchstart', (e) => { e.preventDefault(); simulateKey(key, true); });
        btn.addEventListener('touchend', () => simulateKey(key, false));
      };

      bindButton('leftBtn', 'ArrowLeft');
      bindButton('rightBtn', 'ArrowRight');
      bindButton('jumpBtn', 'ArrowUp');
      bindButton('startBtn', 'Enter');
      bindButton('pauseBtn', 'Escape');
    }

    setupArcadeButtons();
  </script>
</body>
</html>
